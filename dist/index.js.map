{"version":3,"file":"index.js","sources":["../src/useModel.js","../src/useValidation.js","../src/index.js"],"sourcesContent":["/**\n* @overview react form hook for model binding\n* @author shiwei.lv\n*/\n\nimport React, { useState } from 'react';\n\n\n/**\n * 表单数据绑定模型\n * @param {object} initvalue 初始化赋值\n */\nexport default function useModel(initvalue = {}) {\n  const [model, setModel] = useState(initvalue);\n\n  const setModelWrapper = function() {\n    // setModel(key, value)\n    // set field individual\n    if (typeof arguments[0] === 'string') {\n      const name = arguments[0];\n      const value = arguments[1];\n      const tm = {...model};\n      tm[name] = value;\n      setModel(tm);\n      return;\n    }\n\n    // setModel({...obj})\n    // set entire model object\n    if (typeof arguments[0] === 'object') {\n      setModel({...model, ...arguments[0]});\n      return;\n    }\n  };\n\n  return [model, setModelWrapper];\n}\n","/**\n* @overview react hook for form validation\n* @author shiwei.lv\n*/\n\nimport React, { useState } from 'react';\nimport { reach } from 'yup';\n/**\n * validation hook.\n * @param {Yup Schema} schema yup schema\n */\nexport default function useValidate(schema) {\n  const [errors, setErrors] = useState([]);\n\n  /**\n   * 添加验证错误\n   * @param {*} path 验证规则路径\n   * @param {*} e 错误实例\n   */\n  const addErrorItem = (path, e) => {\n    if (!errors.some(item => item.path === path)) {\n      e.path = path;\n      errors.push(e);\n      setErrors([...errors]);\n    }\n  };\n  /**\n   * 删除验证错误\n   * @param {*} path 验证规则路径\n   */\n  const removeErrorItem = (path) => {\n    const index = errors.findIndex(e => e.path === path);\n    if (index > -1) {\n      errors.splice(index, 1);\n      setErrors([...errors]);\n    }\n  };\n\n  /**\n   * 验证整个对象\n   */\n  const validateModel = (model) => {\n    return new Promise((resolve, reject) => {\n      schema.validate(model, {abortEarly: false})\n        .then(() => {\n          setErrors([]);\n          resolve();\n        })\n        .catch(e => {\n          if (Array.isArray(e.inner) && e.inner.length > 0) {\n            setErrors([...e.inner]);\n            reject({message: e.errors[0], details: e});\n          } else {\n            e.path = name;\n            setErrors([e]);\n            reject({message: e.message, details: e});\n          }\n        });\n    });\n  };\n  /**\n   * 验证指定字段名与值\n   * @param {string} name 字段名\n   * @param {*} value 指定值\n   */\n  const validateField = (name, value) => {\n    return new Promise((resolve, reject) => {\n      const slice = reach(schema, name);\n      if (slice) {\n        slice.validate(value)\n          .then(() => {\n            removeErrorItem(name);\n            resolve();\n          })\n          .catch((e) => {\n            addErrorItem(name, e);\n            reject({message: e.message, details: e});\n          });\n      } else {\n        reject({message: '找不到验证规则'});\n      }\n    });\n  };\n\n  const validateWrapper = function() {\n    if (arguments.length === 1) {\n      return validateModel(arguments[0]);\n    } else if (arguments.length === 2) {\n      return validateField(arguments[0], arguments[1]);\n    } else {\n      return undefined;\n    }\n  };\n\n  return [validateWrapper, errors];\n}\n","import useModel from './useModel';\nimport useValidation from  './useValidation';\n\nexport default {\n  useModel, \n  useValidation\n};"],"names":["useModel","initvalue","useState","model","setModel","setModelWrapper","arguments","name","value","tm","useValidate","schema","errors","setErrors","addErrorItem","path","e","some","item","push","removeErrorItem","index","findIndex","splice","validateModel","Promise","resolve","reject","validate","abortEarly","then","Array","isArray","inner","length","message","details","validateField","slice","reach","validateWrapper","undefined","useValidation"],"mappings":"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"}